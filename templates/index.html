<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Log Investigation Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h1>AI-Based Log Investigation Dashboard</h1>

<form method="POST" enctype="multipart/form-data">
    <label for="logfile">Upload Log File (CSV):</label>
    <input type="file" id="logfile" name="logfile" accept=".csv" title="Select a CSV log file to analyze">

    <select name="source_ip" title="Filter logs by source IP address">
        <option value="">All Source IPs</option>
        {% for ip in ips %}
        <option value="{{ ip }}">{{ ip }}</option>
        {% endfor %}
    </select>

    <select name="protocol" title="Filter logs by protocol type">
        <option value="">All Protocols</option>
        {% for p in protocols %}
        <option value="{{ p }}">{{ p }}</option>
        {% endfor %}
    </select>

    <select name="inferred_threat" title="Filter logs by inferred threat type">
        <option value="">All Threats</option>
        {% for t in threats %}
        <option value="{{ t }}">{{ t }}</option>
        {% endfor %}
    </select>

    <button type="submit">Analyze</button>
</form>

<form method="POST" action="/export/csv">
    <button type="submit">Export CSV</button>
</form>

<form method="POST" action="/export/pdf">
    <button type="submit">Export PDF Report</button>
</form>

{% if error %}
<p class="error">{{ error }}</p>
{% endif %}

{% if results %}
<table>
    <tr>
        <th>Time</th>
        <th>Source</th>
        <th>Dest</th>
        <th>Protocol</th>
        <th>Action</th>
        <th>Risk</th>
        <th>Threat</th>
        <th>Reason</th>
    </tr>
    {% for r in results %}
    <tr class="{{ 'anomaly' if r.is_anomaly else '' }}">
        <td>{{ r.timestamp }}</td>
        <td>{{ r.source_ip }}</td>
        <td>{{ r.dest_ip }}</td>
        <td>{{ r.protocol }}</td>
        <td>{{ r.action }}</td>
        <td>{{ r.risk_score }}</td>
        <td>{{ r.inferred_threat }}</td>
        <td>{{ r.reason }}</td>
    </tr>
    {% endfor %}
</table>
{% endif %}

</body>
</html>
